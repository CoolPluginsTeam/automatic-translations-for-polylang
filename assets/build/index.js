(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{contentSaveSource:()=>Z,contentSaveTranslate:()=>W,excerptSaveSource:()=>D,excerptSaveTranslate:()=>z,titleSaveSource:()=>$,titleSaveTranslate:()=>G});var a={};e.r(a),e.d(a,{getTranslatedString:()=>X,getTranslationEntry:()=>K});const n=window.ReactDOM;var o=e.n(n);const r=window.wp.element,{createBlock:l}=wp.blocks,{dispatch:s,select:c}=wp.data,i=(e,t,a)=>{const{name:n,attributes:o}=e;let r={...o},s=e,i="";return Object.keys(a.AtfpBlockParseRules).includes(e.name)&&(s=((e,t,a)=>{const n=Object.values(t),o=e.attributes,r=e.clientId,l=(t,n)=>{if(!0===n){const n=new Array(...t),l=new Array;let s=o,i=r;n.forEach((e=>{l.push(e),i+=`atfp${e}`,s=s[e]}));const p=s;if(void 0!==p&&""!==p.trim()){let t=i.replace(/[^a-zA-Z0-9]/g,""),o="";o=/[a-zA-Z]/.test(p)?c("block-atfp/translate").getTranslatedString("content",p,t):p,e.attributes=((t,n,o)=>{const r=Object.keys(a),l=n.slice(-2).join("_");let s=!1;r.includes(l)&&a[l].includes(e.name)&&(n.pop(),s=!0);const c={...t};let i=c;for(let e=0;e<n.length-1;e++)Object.getPrototypeOf(i[n[e]])===Array.prototype?i[n[e]]=[...i[n[e]]]:i[n[e]]={...i[n[e]]},i=i[n[e]];return i[n[n.length-1]]=s?o.replace(/(?<!\\)"|\\"/g,"'"):o,c})(e.attributes,n,o)}}Object.getPrototypeOf(n)===Array.prototype?i(t,n):Object.getPrototypeOf(n)===Object.prototype&&s(t,n)},s=(e,t)=>{Object.keys(t).map((a=>{let n=t;n=n[a];const o=new Array(...e,a);l(o,n)}))},i=(e,t)=>{const a=new Array(...e);let n=o;a.forEach((e=>{n=n[e]})),Object.getPrototypeOf(n)!==Object.prototype?n.forEach(((e,n)=>{const o=new Array;a.forEach((e=>{o.push(e)})),o.push(n),l(o,t[0])})):s(e,t[0])};return n.forEach((e=>{Object.keys(e).forEach((t=>{const a=new Array(t);l(a,e[t])}))})),e})(e,a.AtfpBlockParseRules[e.name],a.AtfpCoreAttrReplace),r=s.attributes),i=l(n,r,t),i},p=(e,t)=>{let a=e.innerBlocks.map((e=>{if(e.name)return p(e,t)}));return i(e,a,t)},u=window.wp.data,m=e=>{const{editPost:t}=(0,u.dispatch)("core/editor"),{modalClose:a,postContent:n}=e;(()=>{const e={};Object.keys(n).filter((e=>"content"!==e)).forEach((t=>{const a=n[t];if(""!==a.trim()){const n=(0,u.select)("block-atfp/translate").getTranslatedString(t,a);e[t]=n}})),t(e)})(),(()=>{const t=n.content;t.length<=0||Object.values(t).forEach((t=>{((e,t)=>{const{name:a}=e;if(a){let a=e.innerBlocks.map((e=>{if(e.name)return p(e,t)}));const n=i(e,a,t);s("core/block-editor").insertBlock(n)}})(t,e.blockRules)}))})(),a()},{__}=wp.i18n,d=e=>{const t=()=>{e.setPopupVisibility(!1)};return React.createElement("div",{className:"modal-header",key:e.modalRender},React.createElement("span",{className:"close",onClick:t},"×"),React.createElement("h2",{className:"notranslate"},__("Step 2 - Start Automatic Translation Process (Beta)","automatic-translation-for-polylang")),React.createElement("div",{className:"save_btn_cont"},React.createElement("button",{className:"notranslate save_it button button-primary",disabled:e.translateStatus,onClick:()=>{const a=e.postContent,n=e.blockRules;m({postContent:a,modalClose:t,blockRules:n}),e.pageTranslate(!0)}},__("Save Translation","automatic-translation-for-polylang"))),React.createElement("div",{style:{display:"none"},className:"ytstats hidden"},__("Wahooo! You have saved your valuable time via auto translating","automatic-translation-for-polylang"),React.createElement("strong",{className:"totalChars"}," ")," ",__("characters using","automatic-translation-for-polylang"),React.createElement("strong",null,React.createElement("a",{href:"https://wordpress.org/support/plugin/automatic-translator-addon-for-loco-translate/reviews/#new-post",target:"_new"},__("Loco Automatic Translate Addon","automatic-translation-for-polylang")))))},g=window.React,{dispatch:f}=wp.data;let y=0;const b=(e,t)=>{Object.keys(t.AtfpBlockParseRules).includes(e.name)&&((e,t,a)=>{const n=Object.values(a),o=(a,n)=>{if(!0===n){const n=new Array(...a),o=new Array;let r=t,l=e;n.forEach((e=>{o.push(e),l+=`atfp${e}`,r=r[e]}));const s=r;if(void 0!==s&&""!==s.trim()){let e=l.replace(/[^a-zA-Z0-9]/g,"");if(!/[a-zA-Z]/.test(s))return!1;f("block-atfp/translate").contentSaveSource(e,s,y),y++}}Object.getPrototypeOf(n)===Array.prototype?l(a,n):Object.getPrototypeOf(n)===Object.prototype&&r(a,n)},r=(e,t)=>{Object.keys(t).map((a=>{let n=t;n=n[a];const r=new Array(...e,a);o(r,n)}))},l=(e,a)=>{const n=new Array(...e);let l=t;n.forEach((e=>{l=l[e]})),Object.getPrototypeOf(l)!==Object.prototype?l.forEach(((e,t)=>{const r=new Array;n.forEach((e=>{r.push(e)})),r.push(t),o(r,a[0])})):r(e,a[0])};n.forEach((e=>{Object.keys(e).forEach((t=>{const a=new Array(t);o(a,e[t])}))}))})(e.clientId,e.attributes,t.AtfpBlockParseRules[e.name])},E=(e,t)=>{e.forEach((e=>{b(e,t),e.innerBlocks&&E(e.innerBlocks,t)}))},_=e=>{const t="google"===e.service?(e=>{let t=(new DOMParser).parseFromString(e,"text/html");return function(e){e.querySelector("body").querySelectorAll("*").forEach((e=>{let t=(e=>{const t=document.createElement("div");t.innerHTML=e;const a=t.firstElementChild;if(!a)return e;const n=a.outerHTML.match(/^<[^>]+>/)[0],o=a.tagName.toLowerCase(),r=new RegExp(`</${o}>`,"i"),l=a.outerHTML.match(r),s=`#atfp_open_translate_span#${n}#atfp_close_translate_span#`;let c=a.outerHTML.replace(n,s);if(l){const e=`#atfp_open_translate_span#</${o}>#atfp_close_translate_span#`;c=c.replace(r,e)}return a.outerHTML=c,t.innerHTML})(e.outerHTML);const a=document.createTextNode(t);e.parentNode.replaceChild(a,e)}))}(t),(e=>e.split(/(#atfp_open_translate_span#.*?#atfp_close_translate_span#)|'/).filter(Boolean).filter((e=>""!==e.trim())))(t.body.innerText)})(e.content):e.content,a=/#atfp_open_translate_span#[\s\S]*?#atfp_close_translate_span#/,n=/#atfp_open_translate_span#|#atfp_close_translate_span#/g;return React.createElement(React.Fragment,null,"google"===e.service?t.map(((e,t)=>a.test(e)?React.createElement("span",{key:t,className:"notranslate atfp-notraslate-tag"},e.replace(n,"")):e)):t)},{parse:R}=wp.blocks,{select:h}=wp.data,v=e=>{const[t,a]=(0,r.useState)([]),n=e.blockRules,o=atfp_ajax_object.ajax_url,l={postId:parseInt(e.postId),atfp_nonce:atfp_ajax_object.ajax_nonce,action:atfp_ajax_object.action_fetch};(0,r.useEffect)((()=>{fetch(o,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams(l)}).then((e=>e.json())).then((t=>{const o=t.data;""!==o.content.trim()&&(o.content=R(o.content)),e.setPostData(o),((e,t)=>{Object.keys(e).forEach((a=>{if("content"===a)((e,t)=>{Object.values(e).forEach((e=>{b(e,t),e.innerBlocks&&E(e.innerBlocks,t)}))})(e[a],t);else{const t=`${a}SaveSource`;f("block-atfp/translate")[t](e[a])}}))})(o,n);const r=h("block-atfp/translate").getTranslationEntry();a(r),e.translateContent(r)})).catch((e=>{console.error("Error fetching post content:",e)}))}),[e.fetchKey]);let s=0;return React.createElement(React.Fragment,null,t.map(((t,a)=>void 0!==t.source&&""!==t.source.trim()&&React.createElement(React.Fragment,null,React.createElement("tr",{key:a},React.createElement("td",null,s++),React.createElement("td",{"data-source":"source_text"},t.source),React.createElement("td",{class:"translate","data-key":t.id,"data-string-type":t.type},React.createElement(_,{service:e.service,content:t.source})))))))},S=e=>React.createElement("div",{className:`notice inline notice-info is-dismissible ${e.className}`},e.children.join(" "));function T(){return T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},T.apply(null,arguments)}const{__:k}=wp.i18n,w=e=>{const{service:t,serviceLabel:a}=e,[n,o]=(0,g.useState)(0);return React.createElement("div",{className:"modal-body"},React.createElement("div",{className:"atfp_translate_progress"},k("Automatic translation is in progress....","automatic-translation-for-polylang"),React.createElement("br",null),k("It will take few minutes, enjoy ☕ coffee in this time!","automatic-translation-for-polylang"),React.createElement("br",null),React.createElement("br",null),k("Please do not leave this window or browser tab while translation is in progress...","automatic-translation-for-polylang")),React.createElement("div",{className:`translator-widget ${t}`},React.createElement("h3",{class:"choose-lang"},k("Choose language","automatic-translation-for-polylang")," ",React.createElement("span",{class:"dashicons-before dashicons-translation"})),React.createElement("div",{id:"atfp_google_translate_element"})),React.createElement("div",{className:"atfp_string_container"},React.createElement("table",{className:"scrolldown",id:"stringTemplate"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"notranslate"},k("S.No","automatic-translation-for-polylang")),React.createElement("th",{className:"notranslate"},k("Source Text","automatic-translation-for-polylang")),React.createElement("th",{className:"notranslate"},k("Translation","automatic-translation-for-polylang")))),React.createElement("tbody",null,React.createElement(v,T({blockRules:e.blockRules,setPostData:t=>{e.updatePostContent(t)}},e,{translateContent:e=>{let t="";e.forEach((e=>{void 0!==e.source&&""!==e.source.trim()&&(t+=" "+e.source)}));const a=t.trim().split(/\s+/).filter((e=>/[a-zA-Z]/.test(e))).length;o(a)}}))))),React.createElement(S,{className:"atfp_string_count"},k("Total Strings Translated:","automatic-translation-for-polylang")," ",n))},{__:j}=wp.i18n,O=e=>{const t=()=>{e.setPopupVisibility(!1)};return React.createElement("div",{className:"modal-footer",key:e.modalRender},React.createElement("div",{className:"save_btn_cont"},React.createElement("button",{className:"notranslate save_it button button-primary",disabled:e.translateStatus,onClick:()=>{const a=e.postContent,n=e.blockRules;m({postContent:a,modalClose:t,blockRules:n}),e.pageTranslate(!0)}},j("Save Translation","automatic-translation-for-polylang"))),React.createElement("div",{style:{display:"none"},className:"ytstats"},j("Wahooo! You have saved your valuable time via auto translating","automatic-translation-for-polylang"),React.createElement("strong",{className:"totalChars"})," ",j("characters using","automatic-translation-for-polylang"),React.createElement("strong",null,React.createElement("a",{href:"https://wordpress.org/support/plugin/automatic-translator-addon-for-loco-translate/reviews/#new-post",target:"_new"},j("Loco Automatic Translate Addon","automatic-translation-for-polylang")))))},{dispatch:x}=wp.data,A=e=>{e.querySelector(".atfp_translate_progress").style.display="none",e.querySelector(".atfp_string_container").style.animation="none",document.body.style.top="0";const t=e.querySelector("button.save_it");t.removeAttribute("disabled"),t.classList.add("translated"),t.classList.remove("notranslate"),(()=>{const e=document.getElementById("atfp_strings_model").querySelector(".atfp_string_container").querySelectorAll("td.translate[data-string-type]"),t={};var a;e.forEach((e=>{const a=e.innerText,n=e.dataset.key,o=e.dataset.stringType,r=e.closest("tr").querySelector('td[data-source="source_text"]').innerText;t[n]={type:o,translateContent:a,source:r}})),a=t,Object.keys(a).map((e=>{const t=a[e];if("content"!==t.type){const e=`${t.type}SaveTranslate`;x("block-atfp/translate")[e](t.translateContent)}else x("block-atfp/translate").contentSaveTranslate(e,t.translateContent,t.source)}))})()},N={google:e=>{document.querySelector("body").setAttribute("translate","no");const{sourceLang:t,targetLang:a,translateStatus:n}=e;new google.translate.TranslateElement({pageLanguage:t,includedLanguages:a,defaultLanguage:t,multilanguagePage:!0,autoDisplay:!1},"atfp_google_translate_element"),document.querySelector("#atfp_google_translate_element").addEventListener("change",(()=>{(e=>{let t=!1;const a=document.getElementById("atfp_strings_model"),n=a.querySelector(".atfp_string_container");n.scrollTop=0;const o=n.scrollHeight,r=Math.min(1e4,o);let l=null;const s=()=>{const e=performance.now();l||(l=e);const t=(e-l)/r,a=(o+2e3)*t;n.scrollTop=a,t<1&&requestAnimationFrame(s)};void 0!==o&&o>100?(a.querySelector(".atfp_translate_progress").style.display="block",setTimeout((()=>{s()}),2e3),n.addEventListener("scroll",(()=>{n.scrollTop+n.clientHeight+50>=n.scrollHeight&&!t&&(e(),A(a),t=!0)})),n.clientHeight+10>=o&&setTimeout((()=>{e(),A(a)}),1500)):setTimeout((()=>{e(),A(a)}),2e3)})(n)}))}};function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},C.apply(null,arguments)}const P=e=>{const[t,a]=(0,r.useState)(e.visibility),[n,o]=(0,r.useState)(""),[l,s]=(0,r.useState)(!0),c=t=>{"google"===e.service&&document.querySelector("div.skiptranslate iframe.skiptranslate")?.contentDocument?.querySelector('a[title="Close"] img[alt="Close"]')?.click(),s(!0),a(!1),e.updateFetch(t)},i=()=>{s(!1)};return(0,r.useEffect)((()=>{const t=e.service;N[t]({...e,translateStatus:i})}),[]),(0,r.useEffect)((()=>{a(!0)}),[e.modalRender]),React.createElement(React.Fragment,null,React.createElement("div",{class:"modal-container",style:{display:t?"block":"none"}},React.createElement("div",{class:"modal-content"},React.createElement(d,{modalRender:e.modalRender,setPopupVisibility:c,postContent:n,blockRules:e.blockRules,translateStatus:l,pageTranslate:e.pageTranslate}),React.createElement(w,C({},e,{updatePostContent:e=>{o(e)},blockRules:e.blockRules})),React.createElement(O,{modalRender:e.modalRender,setPopupVisibility:c,postContent:n,blockRules:e.blockRules,translateStatus:l,pageTranslate:e.pageTranslate}))))},{__:L}=wp.i18n,B=e=>{const[t,a]=(0,r.useState)(!1),[n,l]=(0,r.useState)({}),[s,c]=(0,r.useState)({}),[i,p]=(0,r.useState)({}),[u,m]=(0,r.useState)(!1),d=atfp_ajax_object.ajax_url,g=atfp_ajax_object.atfp_url+"assets/images/",f={atfp_nonce:atfp_ajax_object.ajax_nonce,action:atfp_ajax_object.action_block_rules},y=e=>{a(e)};return(0,r.useEffect)((()=>{const e=document.querySelector('input#atfp-translate-button[name="atfp_meta_box_translate"]');e&&e.addEventListener("click",(()=>{m((e=>!e))}))}),[]),(0,r.useEffect)((()=>{Object.keys(s).length>0||!t||fetch(d,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams(f)}).then((e=>e.json())).then((e=>{const t=JSON.parse(e.data.blockRules);c(t)})).catch((e=>{console.error("Error fetching post content:",e)}))}),[t]),(0,r.useEffect)((()=>{if(Object.keys(s).length<=0)return;const a=new URLSearchParams(window.location.search),r=n,l=r.dataset&&r.dataset.service,c=r.dataset&&r.dataset.serviceLabel,p=atfp_ajax_object.source_lang,u=a.get("new_lang"),d=a.get("from_post"),g=document.getElementById("atfp_strings_model");t&&Object.keys(s).length>0&&(o().render(React.createElement(P,{blockRules:s,visibility:t,updateFetch:y,postId:d,service:l,serviceLabel:c,sourceLang:p,targetLang:u,modalRender:i,pageTranslate:e.pageTranslate}),g),m((e=>!e)))}),[t,s]),React.createElement(React.Fragment,null,u&&React.createElement("div",{className:"modal-container",style:{display:u?"block":"none"}},React.createElement("div",{className:"atfp-settings modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h2",null,L("Step 1 - Select Translation Provider (Beta)","automatic-translation-for-polylang")),React.createElement("span",{className:"close",onClick:()=>m(!1)},"×")),React.createElement("hr",null),React.createElement("strong",{className:"atfp-heading",style:{marginBottom:"10px",display:"inline-block"}},L("Translate Using Google Page Translate Widget","automatic-translation-for-polylang")),React.createElement("div",{className:"inputGroup"},React.createElement("button",{className:"atfp-service-btn translate button button-primary","data-service":"google","data-service-label":"Google Translate",onClick:e=>{let t=e.target.classList.contains("atfp-service-btn")?e.target:e.target.closest(".atfp-service-btn");p((e=>e+1)),l(t),a(!0)}},L("Google Translate (Beta)","automatic-translation-for-polylang")),React.createElement("span",{className:"proonly-button alsofree"},"✔ ",L("Available","automatic-translation-for-polylang")),React.createElement("br",null),React.createElement("a",{href:"https://translate.google.com/",target:"_blank"},React.createElement("img",{style:{marginTop:"5px"},src:`${g}powered-by-google.png`,alt:L("powered by Google Translate Widget","automatic-translation-for-polylang")}))),React.createElement("hr",null),React.createElement("ul",{style:{margin:"0"}},React.createElement("li",null,React.createElement("span",{style:{color:"green"}},"✔")," ",L("Unlimited Translations with Google Translate","automatic-translation-for-polylang")),React.createElement("li",null,React.createElement("span",{style:{color:"green"}},"✔")," ",L("No API Key Required for Google Translate","automatic-translation-for-polylang")),React.createElement("li",null,React.createElement("span",{style:{color:"green"}},"✔")," ",L("Supports Multiple Languages","automatic-translation-for-polylang")," - ",React.createElement("a",{href:"https://en.wikipedia.org/wiki/Google_Translate#Supported_languages",target:"_blank"},L("See Supported Languages","automatic-translation-for-polylang")))),React.createElement("hr",null),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"atfp-setting-close",onClick:()=>m(!1)},L("Close","automatic-translation-for-polylang"))))))},q="SAVE_SOURCE_TITLE",M="SAVE_TRANSLATE_TITLE",I="SAVE_SOURCE_EXCERPT",F="SAVE_TRANSLATE_EXCERPT",H="SAVE_SOURCE_CONTENT",U="SAVE_TRANSLATE_CONTENT",V={title:{},excerpt:{},content:[]},$=e=>({type:q,text:e}),G=e=>({type:M,text:e}),D=e=>({type:I,text:e}),z=e=>({type:F,text:e}),Z=(e,t,a)=>({type:H,text:t,id:e,index:a}),W=(e,t,a)=>({type:U,text:t,id:e,source:a}),K=e=>{const t=new Array;return t.push({id:"title",source:e.title.source,type:"title",target:e.title.target||""}),t.push({id:"excerpt",source:e.excerpt.source,type:"excerpt",target:e.excerpt.target||""}),Object.keys(e.content).map((a=>{const n=e.content[a].index+2;t[n]={type:"content",id:a,source:e.content[a].source,target:e.content[a].target||""}})),t},X=(e,t,a,n=null)=>"content"!==t&&e[t].source===a?e[t].target:e[t]&&e[t][n]&&e[t][n].source===a?void 0!==e[t][n].target?e[t][n].target:e[t][n].source:a,{createReduxStore:Y,register:J}=wp.data;J(Y("block-atfp/translate",{reducer:(e=V,t)=>{switch(t.type){case q:return{...e,title:{...e.title,source:t.text}};case M:return{...e,title:{...e.title,target:t.text}};case I:case F:return{...e,excerpt:{...e.excerpt,target:t.text}};case H:return{...e,content:{...e.content,[t.id]:{...e.content[t.id]||[],source:t.text,index:t.index}}};case U:return e.content[t.id].source===t.source?{...e,content:{...e.content,[t.id]:{...e.content[t.id]||[],target:t.text}}}:e;default:return e}},actions:t,selectors:a}));const Q=()=>{const[e,t]=(0,g.useState)(!1);return(0,g.useEffect)((()=>{if(e){const e=document.querySelector('input#atfp-translate-button[name="atfp_meta_box_translate"]');e&&(e.disabled=!0)}}),[e]),React.createElement(React.Fragment,null,!e&&React.createElement(B,{pageTranslate:e=>{t(e)}}))};(()=>{let e=new Array;e.push('\x3c!-- The Modal --\x3e<div id="atfp-setting-modal"></div>','<div id="atfp_strings_model" class="modal atfp_custom_model"></div>'),e.forEach((e=>{document.body.insertAdjacentHTML("beforeend",e)}))})(),document.addEventListener("DOMContentLoaded",(()=>{wp.element.render(React.createElement(Q,null),document.getElementById("atfp-setting-modal"))}))})();